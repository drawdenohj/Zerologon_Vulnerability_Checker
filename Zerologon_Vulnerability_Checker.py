#!/usr/bin/python3

import socket
import struct

def check_vuln(dc_ip, dc_hostname):
    # Netlogon msg
    netlogon_req = b"\x00" * 4 + b"\x1d\x00\x00\x00" + b"\x00" * 4
    
    try:
        # Connect to the DC
        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        sock.settimeout(5)
        sock.connect((dc_ip, 445))
                
        sock.send(netlogon_req)
        
        netlogon_resp = sock.recv(1024)

        if netlogon_resp[8:12] == b"\x00" * 4:
            print(f"{dc_hostname} is vulnerable to Zerologon!")
        else:
            print(f"{dc_hostname} is not vulnerable to Zerologon.")

    except:
        print(f"Error: Could not connect to {dc_hostname} ({dc_ip})")

if __name__ == "__main__":
    
    dc_ip = input("Enter the IP address of the domain controller: ")
    dc_hostname = input("Enter the hostname of the domain controller: ")

    check_vuln(dc_ip, dc_hostname)
